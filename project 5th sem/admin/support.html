<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support & Complaints | Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #4cc9f0;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --sidebar-bg: #111827;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            --border-color: #334155;
            --border-radius: 12px;
            --box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background-color: var(--sidebar-bg);
            padding: 25px 20px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo-icon {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-menu {
            list-style: none;
            flex-grow: 1;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 14px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .nav-link:hover {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--text-primary);
        }

        .nav-link.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }

        .nav-link i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }

        .logout-btn {
            margin-top: auto;
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .logout-btn:hover {
            background-color: rgba(239, 68, 68, 0.2);
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 30px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header-title h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header-title p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 18px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .stat-icon.open {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .stat-icon.in-progress {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .stat-icon.resolved {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .stat-icon.users {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .stat-icon.providers {
            background-color: rgba(168, 85, 247, 0.1);
            color: #a855f7;
        }

        .stat-trend {
            font-size: 14px;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
        }

        .trend-up {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .trend-down {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 8px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            color: var(--text-secondary);
            border-radius: calc(var(--border-radius) - 4px);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .tab-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }

        /* Search and Filters */
        .action-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .search-container {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .filter-select {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 12px 20px;
            color: var(--text-primary);
            min-width: 180px;
            cursor: pointer;
        }

        .filter-select option {
            background-color: var(--card-bg);
            color: var(--text-primary);
        }

        /* Complaints Container */
        .complaints-container {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .complaints-table {
            width: 100%;
            border-collapse: collapse;
        }

        .complaints-table th {
            text-align: left;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.2);
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .complaints-table td {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .complaints-table tr:last-child td {
            border-bottom: none;
        }

        .complaints-table tr:hover {
            background-color: rgba(255, 255, 255, 0.03);
        }

        /* Complaint Info */
        .complaint-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .complaint-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 18px;
        }

        .complaint-details h4 {
            margin-bottom: 5px;
        }

        .complaint-details p {
            color: var(--text-secondary);
            font-size: 13px;
        }

        /* Badges */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .open {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .in-progress {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .resolved {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .type-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
            margin-top: 5px;
        }

        .user-complaint {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .provider-complaint {
            background-color: rgba(168, 85, 247, 0.1);
            color: #a855f7;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 8px 16px;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .view-btn {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            border: 1px solid rgba(67, 97, 238, 0.3);
        }

        .view-btn:hover {
            background-color: rgba(67, 97, 238, 0.2);
        }

        .resolve-btn {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .resolve-btn:hover {
            background-color: rgba(16, 185, 129, 0.2);
        }

        .reassign-btn {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .reassign-btn:hover {
            background-color: rgba(245, 158, 11, 0.2);
        }

        .escalate-btn {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .escalate-btn:hover {
            background-color: rgba(239, 68, 68, 0.2);
        }

        /* Priority Indicators */
        .priority-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            display: inline-block;
        }

        .high-priority {
            background-color: var(--danger-color);
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }

        .medium-priority {
            background-color: var(--warning-color);
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
        }

        .low-priority {
            background-color: var(--success-color);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 25px;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--danger-color);
        }

        /* Complaint Details */
        .complaint-detail-section {
            margin-bottom: 25px;
        }

        .complaint-detail-section h4 {
            margin-bottom: 15px;
            color: var(--text-secondary);
            font-size: 16px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .detail-row {
            display: flex;
            margin-bottom: 12px;
        }

        .detail-label {
            width: 150px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .detail-value {
            flex: 1;
        }

        .message-box {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--primary-color);
        }

        .message-box p {
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .action-history {
            list-style: none;
        }

        .history-item {
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .history-content {
            flex: 1;
        }

        .history-time {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* Reply Section */
        .reply-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .reply-textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 15px;
            resize: vertical;
        }

        .reply-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }

        .page-btn {
            padding: 8px 16px;
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .page-btn:hover:not(:disabled) {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .page-btn.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 14px;
            border-top: 1px solid var(--border-color);
            margin-top: 30px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                padding: 20px 10px;
            }
            
            .logo-text, .nav-text {
                display: none;
            }
            
            .nav-link i {
                margin-right: 0;
                font-size: 20px;
            }
            
            .main-content {
                margin-left: 70px;
                padding: 20px;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .complaints-table {
                display: block;
                overflow-x: auto;
            }
            
            .action-bar {
                flex-direction: column;
            }
            
            .filter-select {
                width: 100%;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .detail-row {
                flex-direction: column;
                gap: 5px;
            }
            
            .detail-label {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-home"></i>
            </div>
            <div class="logo-text">Admin</div>
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="nav-text">Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="provider.html" class="nav-link">
                    <i class="fas fa-user-check"></i>
                    <span class="nav-text">Provider Verification</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="users.html" class="nav-link">
                    <i class="fas fa-users"></i>
                    <span class="nav-text">User Management</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="reports.html" class="nav-link">
                    <i class="fas fa-chart-bar"></i>
                    <span class="nav-text">Reports</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="support.html" class="nav-link active">
                    <i class="fas fa-headset"></i>
                    <span class="nav-text">Support</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="setting.html" class="nav-link">
                    <i class="fas fa-cog"></i>
                    <span class="nav-text">Settings</span>
                </a>
            </li>
        </ul>
        
        <a href="login.html" class="nav-link logout-btn" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i>
            <span class="nav-text">Logout</span>
        </a>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-title">
                <h1>Support & Complaints</h1>
                <p>Manage user complaints and provider issues</p>
            </div>
            <div class="user-profile">
                <div class="user-avatar">A</div>
                <div class="user-info">
                    <h4>Admin User</h4>
                    <p>Aministrator</p>
                </div>
            </div>
        </header>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon open">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <span class="stat-trend trend-up">+5</span>
                </div>
                <div class="stat-value" id="openComplaints">24</div>
                <div class="stat-label">Open Complaints</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon in-progress">
                        <i class="fas fa-spinner"></i>
                    </div>
                    <span class="stat-trend trend-down">-2</span>
                </div>
                <div class="stat-value" id="inProgressComplaints">18</div>
                <div class="stat-label">In Progress</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon resolved">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <span class="stat-trend trend-up">+12</span>
                </div>
                <div class="stat-value" id="resolvedComplaints">156</div>
                <div class="stat-label">Resolved This Month</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon users">
                        <i class="fas fa-user-friends"></i>
                    </div>
                    <span class="stat-trend trend-up">+8.2%</span>
                </div>
                <div class="stat-value" id="userComplaints">68%</div>
                <div class="stat-label">User Complaints</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon providers">
                        <i class="fas fa-tools"></i>
                    </div>
                    <span class="stat-trend trend-down">-3.4%</span>
                </div>
                <div class="stat-value" id="providerComplaints">32%</div>
                <div class="stat-label">Provider Issues</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon resolved">
                        <i class="fas fa-clock"></i>
                    </div>
                    <span class="stat-trend trend-down">-15%</span>
                </div>
                <div class="stat-value" id="avgResponseTime">2.4h</div>
                <div class="stat-label">Avg. Response Time</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="all">All Complaints</button>
            <button class="tab-btn" data-tab="users">User Complaints</button>
            <button class="tab-btn" data-tab="providers">Provider Issues</button>
            <button class="tab-btn" data-tab="open">Open Tickets</button>
            <button class="tab-btn" data-tab="resolved">Resolved</button>
        </div>

        <!-- Search and Filters -->
        <div class="action-bar">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" id="searchInput" placeholder="Search complaints by ID, name, or issue...">
            </div>
            <select class="filter-select" id="statusFilter">
                <option value="">All Status</option>
                <option value="open">Open</option>
                <option value="in-progress">In Progress</option>
                <option value="resolved">Resolved</option>
            </select>
            <select class="filter-select" id="priorityFilter">
                <option value="">All Priority</option>
                <option value="high">High Priority</option>
                <option value="medium">Medium Priority</option>
                <option value="low">Low Priority</option>
            </select>
            <select class="filter-select" id="dateFilter">
                <option value="">All Time</option>
                <option value="today">Today</option>
                <option value="week">This Week</option>
                <option value="month">This Month</option>
            </select>
        </div>

        <!-- Complaints Table -->
        <div class="complaints-container">
            <table class="complaints-table">
                <thead>
                    <tr>
                        <th>Complaint Details</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Priority</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="complaintsTableBody">
                    <!-- Complaints will be loaded by JavaScript -->
                </tbody>
            </table>
            
            <!-- Pagination -->
            <div class="pagination">
                <button class="page-btn" id="prevPage" disabled>Previous</button>
                <div id="pageNumbers"></div>
                <button class="page-btn" id="nextPage">Next</button>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2023 Admin Dashboard. All rights reserved.</p>
            <p>Last updated: <span id="currentDate"></span></p>
        </footer>
    </main>

    <!-- Complaint Details Modal -->
    <div class="modal" id="complaintModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Complaint Details</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Complaint details will be loaded by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Check if user is logged in
        document.addEventListener('DOMContentLoaded', function() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') || sessionStorage.getItem('isLoggedIn');
            
            if (!isLoggedIn) {
                window.location.href = 'login.html';
                return;
            }
            
            // Set current date in footer
            const currentDate = new Date().toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('currentDate').textContent = currentDate;

            // Highlight current page in sidebar
            highlightCurrentPage();
            
            // Load complaints data
            loadComplaints();
            
            // Setup event listeners
            setupEventListeners();
            
            // Setup logout functionality
            setupLogout();
        });

        // Function to highlight current page in sidebar
        function highlightCurrentPage() {
            const currentPage = window.location.pathname.split('/').pop() || 'dashboard.html';
            const navLinks = document.querySelectorAll('.nav-link');
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                const href = link.getAttribute('href');
                if (href === currentPage) {
                    link.classList.add('active');
                }
            });
        }

        // Complaints Data - Both User and Provider Complaints
        const complaintsData = [
            // User Complaints (Complaints FROM users ABOUT providers)
            {
                id: "COMP-2023-001",
                type: "user",
                status: "open",
                priority: "high",
                createdAt: "2023-12-10 14:30",
                user: {
                    name: "John Doe",
                    email: "john.doe@example.com",
                    phone: "+1 (555) 123-4567",
                    userId: "USR-1001"
                },
                provider: {
                    name: "Mike's Plumbing",
                    providerId: "PRO-2001",
                    service: "Plumbing"
                },
                issue: "Service Not Completed",
                description: "The plumber arrived 2 hours late, did not complete the work, and left the bathroom in a mess. Promised to return but never did.",
                category: "Service Quality",
                bookingId: "BOOK-4567",
                amount: "₹1,200",
                attachments: ["invoice.pdf", "photos.zip"],
                history: [
                    { action: "Complaint filed", by: "John Doe", time: "2023-12-10 14:30" },
                    { action: "Assigned to support", by: "System", time: "2023-12-10 14:35" }
                ]
            },
            {
                id: "COMP-2023-002",
                type: "user",
                status: "in-progress",
                priority: "medium",
                createdAt: "2023-12-09 10:15",
                user: {
                    name: "Sarah Wilson",
                    email: "sarah.wilson@example.com",
                    phone: "+1 (555) 234-5678",
                    userId: "USR-1002"
                },
                provider: {
                    name: "CleanPro Services",
                    providerId: "PRO-2003",
                    service: "Cleaning"
                },
                issue: "Damaged Property",
                description: "The cleaning staff broke my antique vase worth ₹5,000. They denied responsibility and refused to compensate.",
                category: "Property Damage",
                bookingId: "BOOK-4789",
                amount: "₹2,500",
                attachments: ["damage_photos.jpg", "receipt.pdf"],
                history: [
                    { action: "Complaint filed", by: "Sarah Wilson", time: "2023-12-09 10:15" },
                    { action: "Assigned to support", by: "System", time: "2023-12-09 10:20" },
                    { action: "Contacted provider", by: "Support Agent", time: "2023-12-09 14:30" }
                ]
            },
            {
                id: "COMP-2023-003",
                type: "user",
                status: "resolved",
                priority: "low",
                createdAt: "2023-12-05 16:45",
                user: {
                    name: "Robert Chen",
                    email: "robert.chen@example.com",
                    phone: "+1 (555) 456-7890",
                    userId: "USR-1003"
                },
                provider: {
                    name: "Spark Electric",
                    providerId: "PRO-2002",
                    service: "Electrical"
                },
                issue: "Overcharging",
                description: "Was charged ₹3,500 for a simple switch replacement that should cost max ₹1,500. No breakdown provided.",
                category: "Billing Issue",
                bookingId: "BOOK-4123",
                amount: "₹3,500",
                attachments: ["invoice.jpg"],
                resolution: "Refunded ₹2,000 after investigation. Provider warned about pricing transparency.",
                resolvedAt: "2023-12-07 11:20",
                history: [
                    { action: "Complaint filed", by: "Robert Chen", time: "2023-12-05 16:45" },
                    { action: "Assigned to support", by: "System", time: "2023-12-05 16:50" },
                    { action: "Investigation started", by: "Support Agent", time: "2023-12-06 10:15" },
                    { action: "Refund processed", by: "Finance Dept", time: "2023-12-07 11:20" },
                    { action: "Case closed", by: "Support Agent", time: "2023-12-07 11:25" }
                ]
            },
            {
                id: "COMP-2023-004",
                type: "user",
                status: "open",
                priority: "high",
                createdAt: "2023-12-11 09:20",
                user: {
                    name: "Emma Clark",
                    email: "emma.clark@example.com",
                    phone: "+1 (555) 901-2345",
                    userId: "USR-1004"
                },
                provider: {
                    name: "Green Thumb Gardening",
                    providerId: "PRO-2005",
                    service: "Gardening"
                },
                issue: "No Show",
                description: "Gardener never showed up for scheduled appointment. No call, no message. Waited 3 hours.",
                category: "No Show",
                bookingId: "BOOK-4987",
                amount: "₹800",
                attachments: [],
                history: [
                    { action: "Complaint filed", by: "Emma Clark", time: "2023-12-11 09:20" },
                    { action: "Assigned to support", by: "System", time: "2023-12-11 09:25" }
                ]
            },

            // Provider Complaints (Complaints FROM providers ABOUT users or system)
            {
                id: "COMP-2023-101",
                type: "provider",
                status: "open",
                priority: "medium",
                createdAt: "2023-12-10 16:30",
                provider: {
                    name: "Mike's Plumbing",
                    email: "mike@plumbing.com",
                    phone: "+1 (555) 111-2222",
                    providerId: "PRO-2001"
                },
                user: {
                    name: "David Brown",
                    userId: "USR-1006"
                },
                issue: "Payment Not Received",
                description: "Completed plumbing work 5 days ago. User promised to pay after service but hasn't made payment. ₹2,500 pending.",
                category: "Payment Issue",
                bookingId: "BOOK-4678",
                amount: "₹2,500",
                attachments: ["work_completion.jpg", "invoice.pdf"],
                history: [
                    { action: "Complaint filed", by: "Mike Johnson", time: "2023-12-10 16:30" },
                    { action: "Assigned to support", by: "System", time: "2023-12-10 16:35" }
                ]
            },
            {
                id: "COMP-2023-102",
                type: "provider",
                status: "in-progress",
                priority: "high",
                createdAt: "2023-12-09 12:45",
                provider: {
                    name: "CleanPro Services",
                    email: "john@cleanpro.com",
                    phone: "+1 (555) 333-4444",
                    providerId: "PRO-2003"
                },
                user: {
                    name: "Lisa Taylor",
                    userId: "USR-1008"
                },
                issue: "False Accusation",
                description: "User falsely accused our staff of stealing jewelry. Security footage proves our staff never entered that room.",
                category: "False Allegation",
                bookingId: "BOOK-4890",
                amount: "₹3,000",
                attachments: ["security_footage.mp4", "floor_plan.pdf"],
                history: [
                    { action: "Complaint filed", by: "John Davis", time: "2023-12-09 12:45" },
                    { action: "Assigned to legal", by: "System", time: "2023-12-09 12:50" },
                    { action: "Evidence collected", by: "Legal Team", time: "2023-12-09 15:30" }
                ]
            },
            {
                id: "COMP-2023-103",
                type: "provider",
                status: "resolved",
                priority: "low",
                createdAt: "2023-12-03 11:20",
                provider: {
                    name: "Spark Electric",
                    email: "sarah@electric.com",
                    phone: "+1 (555) 555-6666",
                    providerId: "PRO-2002"
                },
                issue: "App Issue",
                description: "Booking notifications are delayed by 2-3 hours. Missed two bookings because of this. Need immediate fix.",
                category: "Technical Issue",
                bookingId: "N/A",
                amount: "N/A",
                resolution: "Fixed notification delay in app update v2.3.1. Compensated provider for missed bookings.",
                resolvedAt: "2023-12-05 14:15",
                history: [
                    { action: "Complaint filed", by: "Sarah Wilson", time: "2023-12-03 11:20" },
                    { action: "Assigned to tech team", by: "System", time: "2023-12-03 11:25" },
                    { action: "Bug identified", by: "Tech Team", time: "2023-12-04 09:30" },
                    { action: "Fix deployed", by: "Tech Team", time: "2023-12-05 10:45" },
                    { action: "Compensation processed", by: "Finance", time: "2023-12-05 14:15" }
                ]
            },
            {
                id: "COMP-2023-104",
                type: "provider",
                status: "open",
                priority: "medium",
                createdAt: "2023-12-11 08:15",
                provider: {
                    name: "Green Thumb Gardening",
                    email: "maria@greenthumb.com",
                    phone: "+1 (555) 777-8888",
                    providerId: "PRO-2005"
                },
                user: {
                    name: "Thomas Anderson",
                    userId: "USR-1010"
                },
                issue: "Unsafe Working Conditions",
                description: "User's dog was aggressive and not restrained. Staff felt unsafe. Need policy for such situations.",
                category: "Safety Concern",
                bookingId: "BOOK-4999",
                amount: "₹1,200",
                attachments: [],
                history: [
                    { action: "Complaint filed", by: "Maria Garcia", time: "2023-12-11 08:15" },
                    { action: "Assigned to support", by: "System", time: "2023-12-11 08:20" }
                ]
            },
            {
                id: "COMP-2023-105",
                type: "provider",
                status: "in-progress",
                priority: "medium",
                createdAt: "2023-12-08 14:00",
                provider: {
                    name: "FixIt All Repair",
                    email: "robert@fixit.com",
                    phone: "+1 (555) 999-0000",
                    providerId: "PRO-2004"
                },
                issue: "Commission Delay",
                description: "Commission for November bookings (₹8,450) not received yet. Usually paid by 5th of month.",
                category: "Payment Delay",
                bookingId: "N/A",
                amount: "₹8,450",
                attachments: ["statement_nov.pdf"],
                history: [
                    { action: "Complaint filed", by: "Robert Chen", time: "2023-12-08 14:00" },
                    { action: "Assigned to finance", by: "System", time: "2023-12-08 14:05" },
                    { action: "Payment processed", by: "Finance", time: "2023-12-09 10:30" }
                ]
            }
        ];

        // Add more sample complaints
        for (let i = 5; i <= 25; i++) {
            const types = ['user', 'provider'];
            const statuses = ['open', 'in-progress', 'resolved'];
            const priorities = ['high', 'medium', 'low'];
            const categories = {
                user: ['Service Quality', 'Delay', 'Overcharging', 'Property Damage', 'No Show', 'Rude Behavior'],
                provider: ['Payment Issue', 'False Accusation', 'Technical Issue', 'Safety Concern', 'Policy Issue', 'Rating Dispute']
            };
            
            const type = types[Math.floor(Math.random() * types.length)];
            const status = statuses[Math.floor(Math.random() * statuses.length)];
            const priority = priorities[Math.floor(Math.random() * priorities.length)];
            const category = categories[type][Math.floor(Math.random() * categories[type].length)];
            
            complaintsData.push({
                id: `COMP-2023-${100 + i}`,
                type: type,
                status: status,
                priority: priority,
                createdAt: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString(),
                user: type === 'user' ? {
                    name: `User ${i}`,
                    email: `user${i}@example.com`,
                    phone: `+1 (555) ${100 + i}-${2000 + i}`,
                    userId: `USR-${1000 + i}`
                } : {
                    name: `Provider User ${i}`,
                    userId: `USR-${2000 + i}`
                },
                provider: type === 'user' ? {
                    name: `Provider ${i}`,
                    providerId: `PRO-${2000 + i}`,
                    service: ['Plumbing', 'Electrical', 'Cleaning', 'Repair'][Math.floor(Math.random() * 4)]
                } : {
                    name: `Complaining Provider ${i}`,
                    email: `provider${i}@example.com`,
                    phone: `+1 (555) ${300 + i}-${4000 + i}`,
                    providerId: `PRO-${2000 + i}`
                },
                issue: `${category} Issue`,
                description: `Sample complaint description for ${category.toLowerCase()} issue. This needs to be addressed.`,
                category: category,
                bookingId: `BOOK-${4000 + i}`,
                amount: `₹${Math.floor(Math.random() * 5000) + 500}`,
                attachments: Math.random() > 0.5 ? ['document.pdf'] : [],
                history: [
                    { action: "Complaint filed", by: type === 'user' ? 'User' : 'Provider', time: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString() },
                    { action: "Assigned to support", by: "System", time: new Date(Date.now() - Math.random() * 6 * 24 * 60 * 60 * 1000).toISOString() }
                ]
            });
        }

        // Pagination variables
        let currentPage = 1;
        const itemsPerPage = 8;
        let filteredComplaints = [...complaintsData];
        let currentTab = 'all';

        // Load Complaints
        function loadComplaints() {
            const tableBody = document.getElementById('complaintsTableBody');
            tableBody.innerHTML = '';
            
            // Calculate pagination
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageComplaints = filteredComplaints.slice(startIndex, endIndex);
            
            if (pageComplaints.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            No complaints found matching your criteria.
                        </td>
                    </tr>
                `;
                return;
            }
            
            pageComplaints.forEach(complaint => {
                const row = document.createElement('tr');
                
                // Determine avatar and name based on complaint type
                const avatarName = complaint.type === 'user' ? complaint.user.name : complaint.provider.name;
                const avatarInitial = avatarName.charAt(0);
                const complaintSubject = complaint.type === 'user' 
                    ? `Complaint about ${complaint.provider.name}`
                    : `Issue reported by ${complaint.provider.name}`;
                
                row.innerHTML = `
                    <td>
                        <div class="complaint-info">
                            <div class="complaint-avatar">${avatarInitial}</div>
                            <div class="complaint-details">
                                <h4>${complaint.issue}</h4>
                                <p>${complaintSubject}</p>
                                <p style="font-size: 12px; margin-top: 4px;">
                                    ID: ${complaint.id} • ${formatDateTime(complaint.createdAt)}
                                </p>
                                <span class="type-badge ${complaint.type === 'user' ? 'user-complaint' : 'provider-complaint'}">
                                    ${complaint.type === 'user' ? 'User Complaint' : 'Provider Issue'}
                                </span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div>${complaint.category}</div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                            ${complaint.type === 'user' ? 'About: ' + complaint.provider.service : 'System/User Issue'}
                        </div>
                    </td>
                    <td>
                        <span class="status-badge ${complaint.status}">
                            ${complaint.status === 'in-progress' ? 'In Progress' : complaint.status.charAt(0).toUpperCase() + complaint.status.slice(1)}
                        </span>
                    </td>
                    <td>
                        <span class="priority-indicator ${complaint.priority}-priority"></span>
                        <span style="text-transform: capitalize;">${complaint.priority} Priority</span>
                    </td>
                    <td>${formatDate(new Date(complaint.createdAt))}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view-btn" onclick="viewComplaintDetails('${complaint.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            ${complaint.status !== 'resolved' ? `
                                <button class="action-btn resolve-btn" onclick="resolveComplaint('${complaint.id}')">
                                    <i class="fas fa-check"></i> Resolve
                                </button>
                            ` : ''}
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            updatePagination();
            updateStats();
        }

        // Update Stats
        function updateStats() {
            const total = filteredComplaints.length;
            const open = filteredComplaints.filter(c => c.status === 'open').length;
            const inProgress = filteredComplaints.filter(c => c.status === 'in-progress').length;
            const resolved = filteredComplaints.filter(c => c.status === 'resolved').length;
            const userComplaints = filteredComplaints.filter(c => c.type === 'user').length;
            const providerComplaints = filteredComplaints.filter(c => c.type === 'provider').length;
            
            const userPercentage = total > 0 ? Math.round((userComplaints / total) * 100) : 0;
            const providerPercentage = total > 0 ? Math.round((providerComplaints / total) * 100) : 0;
            
            document.getElementById('openComplaints').textContent = open;
            document.getElementById('inProgressComplaints').textContent = inProgress;
            document.getElementById('resolvedComplaints').textContent = resolved;
            document.getElementById('userComplaints').textContent = userPercentage + '%';
            document.getElementById('providerComplaints').textContent = providerPercentage + '%';
        }

        // Update Pagination
        function updatePagination() {
            const totalPages = Math.ceil(filteredComplaints.length / itemsPerPage);
            const pageNumbers = document.getElementById('pageNumbers');
            const prevBtn = document.getElementById('prevPage');
            const nextBtn = document.getElementById('nextPage');
            
            // Update buttons state
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages || totalPages === 0;
            
            // Generate page numbers
            pageNumbers.innerHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => {
                    currentPage = i;
                    loadComplaints();
                };
                pageNumbers.appendChild(pageBtn);
            }
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentTab = btn.dataset.tab;
                    currentPage = 1;
                    filterComplaints();
                });
            });
            
            // Search input
            document.getElementById('searchInput').addEventListener('input', debounce(filterComplaints, 300));
            
            // Filter selects
            document.getElementById('statusFilter').addEventListener('change', filterComplaints);
            document.getElementById('priorityFilter').addEventListener('change', filterComplaints);
            document.getElementById('dateFilter').addEventListener('change', filterComplaints);
            
            // Pagination buttons
            document.getElementById('prevPage').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    loadComplaints();
                }
            });
            
            document.getElementById('nextPage').addEventListener('click', () => {
                const totalPages = Math.ceil(filteredComplaints.length / itemsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    loadComplaints();
                }
            });
            
            // Modal close
            document.getElementById('closeModal').addEventListener('click', () => {
                document.getElementById('complaintModal').style.display = 'none';
            });
            
            // Close modal when clicking outside
            document.getElementById('complaintModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('complaintModal')) {
                    document.getElementById('complaintModal').style.display = 'none';
                }
            });
        }

        // Setup Logout
        function setupLogout() {
            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('username');
                sessionStorage.removeItem('isLoggedIn');
                sessionStorage.removeItem('username');
                
                window.location.href = 'login.html';
            });
        }

        // Filter Complaints
        function filterComplaints() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            filteredComplaints = complaintsData.filter(complaint => {
                // Tab filter
                if (currentTab !== 'all') {
                    if (currentTab === 'users' && complaint.type !== 'user') return false;
                    if (currentTab === 'providers' && complaint.type !== 'provider') return false;
                    if (currentTab === 'open' && complaint.status !== 'open') return false;
                    if (currentTab === 'resolved' && complaint.status !== 'resolved') return false;
                }
                
                // Search filter
                const matchesSearch = searchTerm === '' ||
                    complaint.id.toLowerCase().includes(searchTerm) ||
                    complaint.issue.toLowerCase().includes(searchTerm) ||
                    (complaint.type === 'user' ? complaint.user.name.toLowerCase() : complaint.provider.name.toLowerCase()).includes(searchTerm) ||
                    complaint.description.toLowerCase().includes(searchTerm);
                
                if (!matchesSearch) return false;
                
                // Status filter
                if (statusFilter && complaint.status !== statusFilter) return false;
                
                // Priority filter
                if (priorityFilter && complaint.priority !== priorityFilter) return false;
                
                // Date filter
                if (dateFilter) {
                    const complaintDate = new Date(complaint.createdAt);
                    const today = new Date();
                    
                    switch (dateFilter) {
                        case 'today':
                            return complaintDate.toDateString() === today.toDateString();
                        case 'week':
                            const oneWeekAgo = new Date();
                            oneWeekAgo.setDate(today.getDate() - 7);
                            return complaintDate >= oneWeekAgo;
                        case 'month':
                            const oneMonthAgo = new Date();
                            oneMonthAgo.setMonth(today.getMonth() - 1);
                            return complaintDate >= oneMonthAgo;
                    }
                }
                
                return true;
            });
            
            currentPage = 1;
            loadComplaints();
        }

        // View Complaint Details
        function viewComplaintDetails(complaintId) {
            const complaint = complaintsData.find(c => c.id === complaintId);
            if (!complaint) return;
            
            document.getElementById('modalTitle').textContent = `Complaint: ${complaint.id}`;
            
            const detailsHTML = `
                <div class="complaint-detail-section">
                    <h4>Basic Information</h4>
                    <div class="detail-row">
                        <span class="detail-label">Complaint ID:</span>
                        <span class="detail-value">${complaint.id}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Type:</span>
                        <span class="detail-value">
                            <span class="type-badge ${complaint.type === 'user' ? 'user-complaint' : 'provider-complaint'}">
                                ${complaint.type === 'user' ? 'User Complaint' : 'Provider Issue'}
                            </span>
                        </span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Status:</span>
                        <span class="detail-value">
                            <span class="status-badge ${complaint.status}">
                                ${complaint.status === 'in-progress' ? 'In Progress' : complaint.status.charAt(0).toUpperCase() + complaint.status.slice(1)}
                            </span>
                        </span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Priority:</span>
                        <span class="detail-value">
                            <span class="priority-indicator ${complaint.priority}-priority"></span>
                            ${complaint.priority.charAt(0).toUpperCase() + complaint.priority.slice(1)} Priority
                        </span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Created:</span>
                        <span class="detail-value">${formatDateTime(complaint.createdAt)}</span>
                    </div>
                    ${complaint.resolvedAt ? `
                        <div class="detail-row">
                            <span class="detail-label">Resolved:</span>
                            <span class="detail-value">${formatDateTime(complaint.resolvedAt)}</span>
                        </div>
                    ` : ''}
                </div>
                
                <div class="complaint-detail-section">
                    <h4>${complaint.type === 'user' ? 'Complaint From User' : 'Issue From Provider'}</h4>
                    ${complaint.type === 'user' ? `
                        <div class="detail-row">
                            <span class="detail-label">User Name:</span>
                            <span class="detail-value">${complaint.user.name}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">User ID:</span>
                            <span class="detail-value">${complaint.user.userId}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Email:</span>
                            <span class="detail-value">${complaint.user.email}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Phone:</span>
                            <span class="detail-value">${complaint.user.phone}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Against Provider:</span>
                            <span class="detail-value">${complaint.provider.name} (${complaint.provider.service})</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Provider ID:</span>
                            <span class="detail-value">${complaint.provider.providerId}</span>
                        </div>
                    ` : `
                        <div class="detail-row">
                            <span class="detail-label">Provider Name:</span>
                            <span class="detail-value">${complaint.provider.name}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Provider ID:</span>
                            <span class="detail-value">${complaint.provider.providerId}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Email:</span>
                            <span class="detail-value">${complaint.provider.email}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Phone:</span>
                            <span class="detail-value">${complaint.provider.phone}</span>
                        </div>
                        ${complaint.user ? `
                            <div class="detail-row">
                                <span class="detail-label">Related User:</span>
                                <span class="detail-value">${complaint.user.name} (${complaint.user.userId})</span>
                            </div>
                        ` : ''}
                    `}
                </div>
                
                <div class="complaint-detail-section">
                    <h4>Complaint Details</h4>
                    <div class="detail-row">
                        <span class="detail-label">Issue:</span>
                        <span class="detail-value">${complaint.issue}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Category:</span>
                        <span class="detail-value">${complaint.category}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Booking ID:</span>
                        <span class="detail-value">${complaint.bookingId}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Amount:</span>
                        <span class="detail-value">${complaint.amount}</span>
                    </div>
                    
                    <div class="message-box">
                        <h5 style="margin-bottom: 10px; color: var(--text-primary);">Description:</h5>
                        <p>${complaint.description}</p>
                    </div>
                    
                    ${complaint.attachments && complaint.attachments.length > 0 ? `
                        <div class="detail-row">
                            <span class="detail-label">Attachments:</span>
                            <span class="detail-value">
                                ${complaint.attachments.map(att => 
                                    `<div style="margin-bottom: 5px;">
                                        <i class="fas fa-paperclip"></i> ${att}
                                    </div>`
                                ).join('')}
                            </span>
                        </div>
                    ` : ''}
                </div>
                
                ${complaint.resolution ? `
                    <div class="complaint-detail-section">
                        <h4>Resolution</h4>
                        <div class="message-box" style="border-left-color: var(--success-color);">
                            <p>${complaint.resolution}</p>
                        </div>
                    </div>
                ` : ''}
                
                <div class="complaint-detail-section">
                    <h4>Action History</h4>
                    <ul class="action-history">
                        ${complaint.history.map(item => `
                            <li class="history-item">
                                <div class="history-icon" style="background-color: rgba(67, 97, 238, 0.1); color: var(--primary-color);">
                                    <i class="fas fa-history"></i>
                                </div>
                                <div class="history-content">
                                    <div>${item.action}</div>
                                    <div class="history-time">By ${item.by} at ${formatDateTime(item.time)}</div>
                                </div>
                            </li>
                        `).join('')}
                    </ul>
                </div>
                
                ${complaint.status !== 'resolved' ? `
                    <div class="reply-section">
                        <h4>Take Action</h4>
                        <textarea class="reply-textarea" placeholder="Add notes or update on this complaint..." id="actionNotes"></textarea>
                        <div class="modal-actions">
                            <button class="action-btn reassign-btn" onclick="reassignComplaint('${complaint.id}')">
                                <i class="fas fa-user-friends"></i> Reassign
                            </button>
                            <button class="action-btn escalate-btn" onclick="escalateComplaint('${complaint.id}')">
                                <i class="fas fa-exclamation-triangle"></i> Escalate
                            </button>
                            <button class="action-btn resolve-btn" onclick="resolveComplaint('${complaint.id}', true)">
                                <i class="fas fa-check"></i> Mark Resolved
                            </button>
                        </div>
                    </div>
                ` : ''}
            `;
            
            document.getElementById('modalBody').innerHTML = detailsHTML;
            document.getElementById('complaintModal').style.display = 'flex';
        }

        // Resolve Complaint
        function resolveComplaint(complaintId, fromModal = false) {
            const complaintIndex = complaintsData.findIndex(c => c.id === complaintId);
            if (complaintIndex === -1) return;
            
            if (confirm(`Are you sure you want to mark complaint ${complaintId} as resolved?`)) {
                complaintsData[complaintIndex].status = 'resolved';
                complaintsData[complaintIndex].resolvedAt = new Date().toISOString();
                complaintsData[complaintIndex].resolution = "Complaint resolved by support team.";
                
                // Add to history
                complaintsData[complaintIndex].history.push({
                    action: "Marked as resolved",
                    by: "Admin User",
                    time: new Date().toISOString()
                });
                
                showNotification(`Complaint ${complaintId} has been marked as resolved.`);
                
                if (fromModal) {
                    document.getElementById('complaintModal').style.display = 'none';
                }
                
                filterComplaints();
            }
        }

        // Reassign Complaint
        function reassignComplaint(complaintId) {
            const agents = ['Support Team A', 'Support Team B', 'Technical Team', 'Legal Team', 'Finance Team'];
            const randomAgent = agents[Math.floor(Math.random() * agents.length)];
            
            const complaintIndex = complaintsData.findIndex(c => c.id === complaintId);
            if (complaintIndex !== -1) {
                complaintsData[complaintIndex].history.push({
                    action: `Reassigned to ${randomAgent}`,
                    by: "Admin User",
                    time: new Date().toISOString()
                });
                
                showNotification(`Complaint reassigned to ${randomAgent}`);
                viewComplaintDetails(complaintId); // Refresh modal view
            }
        }

        // Escalate Complaint
        function escalateComplaint(complaintId) {
            const complaintIndex = complaintsData.findIndex(c => c.id === complaintId);
            if (complaintIndex !== -1) {
                complaintsData[complaintIndex].priority = 'high';
                complaintsData[complaintIndex].history.push({
                    action: "Escalated to high priority",
                    by: "Admin User",
                    time: new Date().toISOString()
                });
                
                showNotification("Complaint escalated to high priority");
                viewComplaintDetails(complaintId); // Refresh modal view
            }
        }

        // Utility Functions
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return 'N/A';
            const date = new Date(dateTimeString);
            return date.toLocaleString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: #1e293b;
                color: #f1f5f9;
                padding: 15px 25px;
                border-radius: var(--border-radius);
                border-left: 4px solid #4361ee;
                box-shadow: var(--box-shadow);
                z-index: 1000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Initialize on load
        window.onload = () => {
            loadComplaints();
            setupEventListeners();
        };
    </script>
</body>
</html>